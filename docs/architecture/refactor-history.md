# æ¶æ„é‡æ„æ€»ç»“

## ğŸ¯ é‡æ„ç›®æ ‡
ä¸ºå®ç°æœ€å¤æ‚çš„æ–¹æ¡ˆä¸‰ï¼ˆTypeScript AST æ¡¥æ¥ï¼‰æ‰“ä¸‹åŸºç¡€ï¼ŒæŠ½å–å…±æœ‰éƒ¨åˆ†ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚

## âœ… å·²å®Œæˆçš„é‡æ„

### 1. æ ¸å¿ƒæŠ½è±¡å±‚ (`src/core/`)
- **ç±»å‹ç³»ç»Ÿ** (`types.ts`): å®šä¹‰äº†ç»Ÿä¸€çš„æ¥å£å’Œç±»å‹
- **åŸºç¡€ç»„åˆå‡½æ•°** (`useBaseEditor.ts`): æä¾›é€šç”¨çš„ç¼–è¾‘å™¨é€»è¾‘

### 2. è½¬æ¢å™¨å±‚ (`src/transformers/`)
- **JsonTransformer**: JSON ç»“æ„è½¬æ¢å™¨
- **MathJSTransformer**: MathJS AST è½¬æ¢å™¨  
- **TypeScriptTransformer**: TypeScript AST è½¬æ¢å™¨ (ä¸ºæ–¹æ¡ˆä¸‰å‡†å¤‡)

### 3. é«˜äº®æ˜ å°„å±‚ (`src/highlightMappers/`)
- **MathJSHighlightMapper**: åŸºäºç°æœ‰ä»£ç é‡æ„çš„ MathJS æ˜ å°„å™¨

### 4. ç»„ä»¶é‡æ„ç¤ºä¾‹
- **RefactoredExpressionComponent**: å±•ç¤ºå¦‚ä½•ä½¿ç”¨æ–°æ¶æ„

## ğŸ—ï¸ æ¶æ„ä¼˜åŠ¿

### é«˜åº¦æ¨¡å—åŒ–
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç»„ä»¶å±‚ (Vue)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºç¡€ç¼–è¾‘å™¨é€»è¾‘  â”‚ â† useBaseEditor composable
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    è½¬æ¢å™¨å±‚     â”‚ â† AbstractTransformer<T>
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   é«˜äº®æ˜ å°„å±‚    â”‚ â† HighlightMapper<T>
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    æ ¸å¿ƒç±»å‹     â”‚ â† ç»Ÿä¸€çš„ç±»å‹å®šä¹‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç±»å‹å®‰å…¨
- æ³›å‹è®¾è®¡ç¡®ä¿ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- ç»Ÿä¸€çš„æ¥å£å®šä¹‰é˜²æ­¢è¿è¡Œæ—¶é”™è¯¯

### å¯æ‰©å±•æ€§
- æ–°å¢è½¬æ¢å™¨åªéœ€å®ç° `AbstractTransformer<T>` æ¥å£
- æ’ä»¶åŒ–çš„æ¶æ„æ”¯æŒä»»æ„æ•°æ®æ ¼å¼

## ğŸ”„ ä¸‰ç§æ–¹æ¡ˆçš„ç»Ÿä¸€

### æ–¹æ¡ˆä¸€ï¼šJSON âœ…
```typescript
const transformer = new JsonTransformer()
const { syncContent } = useBaseEditor(props, emit, { transformer })
```

### æ–¹æ¡ˆäºŒï¼šMathJS âœ…
```typescript
const transformer = new MathJSTransformer()
const mapper = new MathJSHighlightMapper()
const { syncContent } = useBaseEditor(props, emit, { transformer, highlightMapper: mapper })
```

### æ–¹æ¡ˆä¸‰ï¼šTypeScript ğŸš§
```typescript
const transformer = new TypeScriptTransformer()
const mapper = new TypeScriptHighlightMapper() // å¾…å®ç°
const { syncContent } = useBaseEditor(props, emit, { transformer, highlightMapper: mapper })
```

## ğŸ“‹ ä¸‹ä¸€æ­¥å®ç°è®¡åˆ’

### çŸ­æœŸç›®æ ‡ (1-2 å‘¨)
1. **å®Œå–„ TypeScript è½¬æ¢å™¨**
   - æ”¹è¿› Blockly â†’ TypeScript è½¬æ¢é€»è¾‘
   - å®ç°æ›´å¤æ‚çš„ TypeScript â†’ Blockly è½¬æ¢

2. **åˆ›å»º TypeScript é«˜äº®æ˜ å°„å™¨**
   - åŸºäº TypeScript AST çš„ä½ç½®æ˜ å°„
   - æ”¯æŒå‡½æ•°ã€å˜é‡ã€ç±»ç­‰å…ƒç´ çš„é€‰æ‹©åŒæ­¥

3. **è®¾è®¡ TypeScript ä¸“ç”¨ Blockly å—**
   - å‡½æ•°å®šä¹‰å—
   - å˜é‡å£°æ˜å—
   - æ¡ä»¶è¯­å¥å—
   - å¾ªç¯è¯­å¥å—

### ä¸­æœŸç›®æ ‡ (2-4 å‘¨)
1. **åˆ›å»ºå®Œæ•´çš„ TypeScript ç¼–è¾‘å™¨ç»„ä»¶**
2. **æ·»åŠ  TypeScript è¯­æ³•éªŒè¯å’Œé”™è¯¯æç¤º**
3. **å®ç°ä»£ç è‡ªåŠ¨å®Œæˆå’Œæ™ºèƒ½æç¤º**

### é•¿æœŸç›®æ ‡ (1-2 æœˆ)
1. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§å‹é¡¹ç›®çš„å¤„ç†èƒ½åŠ›
2. **æ’ä»¶ç³»ç»Ÿ**ï¼šæ”¯æŒè‡ªå®šä¹‰è½¬æ¢å™¨å’Œæ˜ å°„å™¨
3. **åä½œåŠŸèƒ½**ï¼šå¤šäººç¼–è¾‘å’Œç‰ˆæœ¬æ§åˆ¶

## ğŸ”§ ä½¿ç”¨æ–°æ¶æ„çš„å¥½å¤„

### å¯¹å¼€å‘è€…
- **æ›´å°‘é‡å¤ä»£ç **ï¼šåˆ†å‰²é¢æ¿ã€çŠ¶æ€ç®¡ç†ç­‰é€»è¾‘å¤ç”¨
- **æ›´å¥½çš„ç±»å‹æ”¯æŒ**ï¼šTypeScript å…¨é“¾è·¯ç±»å‹æ£€æŸ¥
- **æ›´å®¹æ˜“æµ‹è¯•**ï¼šæ¯ä¸ªå±‚æ¬¡éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•

### å¯¹é¡¹ç›®
- **æ›´å¥½çš„å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„èŒè´£åˆ†ç¦»
- **æ›´å¼ºçš„æ‰©å±•æ€§**ï¼šæ”¯æŒä»»æ„æ–°çš„è½¬æ¢æ ¼å¼
- **æ›´é«˜çš„ä»£ç è´¨é‡**ï¼šç»Ÿä¸€çš„æ¥å£å’Œé”™è¯¯å¤„ç†

## ğŸ“ æ–°çš„æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ core/                    # æ ¸å¿ƒæŠ½è±¡å±‚
â”‚   â”œâ”€â”€ types.ts            # ç»Ÿä¸€ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ useBaseEditor.ts    # åŸºç¡€ç¼–è¾‘å™¨ç»„åˆå‡½æ•°
â”œâ”€â”€ transformers/           # è½¬æ¢å™¨å±‚
â”‚   â”œâ”€â”€ JsonTransformer.ts
â”‚   â”œâ”€â”€ MathJSTransformer.ts
â”‚   â””â”€â”€ TypeScriptTransformer.ts
â”œâ”€â”€ highlightMappers/       # é«˜äº®æ˜ å°„å±‚
â”‚   â””â”€â”€ MathJSHighlightMapper.ts
â”œâ”€â”€ components/
â”‚   â””â”€â”€ expression/
â”‚       â””â”€â”€ RefactoredExpressionComponent.vue
â”œâ”€â”€ architecture.ts         # ç»Ÿä¸€å¯¼å‡º
â””â”€â”€ examples/
    â””â”€â”€ architecture-usage.ts
```

## ğŸ‰ æˆæœ

é€šè¿‡è¿™æ¬¡é‡æ„ï¼Œæˆ‘ä»¬å·²ç»ä¸ºå®ç°æœ€å¤æ‚çš„æ–¹æ¡ˆä¸‰ï¼ˆTypeScript AST æ¡¥æ¥ï¼‰æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ã€‚æ–°æ¶æ„ä¸ä»…æ”¯æŒç°æœ‰çš„ JSON å’Œ MathJS æ–¹æ¡ˆï¼Œè¿˜ä¸º TypeScript æ–¹æ¡ˆæä¾›äº†æ¸…æ™°çš„å®ç°è·¯å¾„ã€‚
